alias: Nibe - Värmeförskjutning till Modbus
description: Skriver värmeförskjutning från input till register 30
trigger:
  - platform: state
    entity_id: input_number.varmeforskjutning
condition:
  - condition: template
    value_template: >
      {{ trigger.to_state.context.user_id is not none or 
         trigger.to_state.context.parent_id is not none }}
action:
  - service: modbus.write_register
    data:
      hub: Nibe
      slave: 1
      address: 30
      value: >
        {% set val = states('input_number.varmeforskjutning') | int %}
        {% if val < 0 %}
          {{ 65536 + val }}
        {% else %}
          {{ val }}
        {% endif %}
mode: single